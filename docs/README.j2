# rtty-soda

A PyNaCl frontend with custom encodings, compression, and key derivation.


#### Features

- Public key encryption (Curve25519-XSalsa20-Poly1305)
- Secret key encryption (XSalsa20-Poly1305)
- Key derivation (Argon2id-Blake2b)
- Text compression:
  - brotli (Brotli, best ratio, default)
  - zstd (Zstandard, fast, good ratio)
  - zlib (Deflate, used by gzip)
  - bz2 (Bzip2, used in tar.bz2)
  - lzma (LZMA, good ratio on large data)
  - raw (No compression, improves security)
- Custom encodings:
  - base10 (Decimal)
  - base26 (Latin)
  - base31 (Cyrillic)
  - base32 (RFC 4648)
  - base36 (Latin with digits)
  - base64 (RFC 4648)
  - base94 (ASCII printable)
  - binary (Raw bytes)


## Installation
#### Package manager

1. [Install uv](https://docs.astral.sh/uv/getting-started/installation/)
2. Install rtty-soda:
   ```
   % uv tool install "rtty-soda[cli]"
   ```
3. Remove rtty-soda:
   ```
   % uv tool uninstall rtty-soda
   ```

#### Docker

```
% docker run -it --rm -h rtty-soda -v .:/app/host nett/{{ project.name }}:{{ project.version }}
% docker run -it --rm -h rtty-soda -v .:/app/host nett/{{ project.name }}:{{ project.version }}-tools
```


## Getting help

All commands have `[-h | --help]` option.

```
% soda
{{ "soda" | shell | trim }}
```

Some commands have aliases, so `% soda encrypt-password ...` and `% soda ep ...`
are equivalent.


## Public key encryption
#### Key generation

```
% soda genkey | tee alice | soda pubkey - | tee alice_pub
{{ "soda genkey | tee docs/alice | soda pubkey - | tee docs/alice_pub" | shell | trim }}

% soda genkey | tee bob | soda pubkey - | tee bob_pub
{{ "soda genkey | tee docs/bob | soda pubkey - | tee docs/bob_pub" | shell | trim }}

% soda genkey -h
{{ "soda genkey -h" | shell | trim }}
```

#### Encryption

Alice sends the message to Bob:

```
% cat message
{{ "cat docs/message" | shell | trim }}

% soda encrypt-public alice bob_pub message | tee encrypted | cut -c 1-80
{{ "soda encrypt-public docs/alice docs/bob_pub docs/message | tee docs/encrypted_public | cut -c 1-80" | shell | trim }}

% soda encrypt-public -h
{{ "soda encrypt-public -h" | shell | trim }}
```

#### Decryption

```
% soda decrypt-public bob alice_pub encrypted
{{ "soda decrypt-public docs/bob docs/alice_pub docs/encrypted_public" | shell | trim }}
{% set _ = "rm docs/encrypted_public" | shell -%}
```


## Secret key encryption

Alice and Bob share a key for symmetric encryption:

```
% soda genkey > shared
{{ "soda genkey > docs/shared" | shell | trim -}}
% soda encrypt-secret shared message -o encrypted
{% set _ = "yes | soda encrypt-secret docs/shared docs/message -o docs/encrypted_secret" | shell -%}
% soda decrypt-secret shared encrypted -o message
{% set _ = "yes | soda decrypt-secret docs/shared docs/encrypted_secret -o docs/message" | shell -%}
{% set _ = "rm docs/encrypted_secret" | shell -%}
```

Another day, they share a password:

```
% echo qwerty | soda encrypt-password - message -p interactive -o encrypted
{% set _ = "rm docs/encrypted_password" | shell -%}
{% set _ = "echo qwerty | soda encrypt-password - docs/message -p interactive -o docs/encrypted_password" | shell -%}
% echo qwerty | soda decrypt-password - encrypted -p interactive -o message
{% set _ = "rm docs/message" | shell -%}
{% set _ = "echo qwerty | soda decrypt-password - docs/encrypted_password -p interactive -o docs/message" | shell -%}
{% set _ = "rm docs/encrypted_password" | shell -%}
```


## Key derivation

The KDF function derives the key from the password using Argon2id, a memory-hard
algorithm that makes brute-force attacks expensive by requiring large amounts of
memory.

It accepts different profiles: 
- interactive (64 MiB, 2 passes)
- moderate (256 MiB, 3 passes)
- sensitive (1 GiB, 4 passes)

The top profile uses 1 GiB - half the memory of the RFC 9106 recommendation for
practical use. The profiles are defined by libsodium.

The KDF function is deterministic, so identical passwords produce identical keys.
No metadata is stored or asked of the user to keep the interface simple.
The trade-off is that password strength is critical.

```
% echo qwerty | soda kdf - -p interactive
{{ "echo qwerty | soda kdf - -p interactive" | shell | trim }}

% soda kdf -h
{{ "soda kdf -h" | shell | trim }}
```

![KDF diagram](https://github.com/theosaveliev/rtty-soda/raw/main/diagram/kdf.png)


## Text compression

That works as follows:
1. The plaintext is prepared:
   - In binary mode (default), the message is read as bytes
   - In text mode (`-t, --text`), the message is read as a string, stripped, and encoded with SCSU, reducing the size of Unicode messages by 15â€“50%
2. The plaintext is compressed with the compression lib
3. The 16-byte MAC and 24-byte nonce are added
4. The result is encoded with Base64, which adds ~33% overhead

```
% soda es shared message -t -v -c brotli > /dev/null
{{ "soda es docs/shared docs/message -t -v -c brotli > /dev/null" | shell | trim }}
% soda es shared message -t -v -c zstd > /dev/null
{{ "soda es docs/shared docs/message -t -v -c zstd > /dev/null" | shell | trim }}
% soda es shared message -t -v -c zlib > /dev/null
{{ "soda es docs/shared docs/message -t -v -c zlib > /dev/null" | shell | trim }}
% soda es shared message -t -v -c bz2 > /dev/null
{{ "soda es docs/shared docs/message -t -v -c bz2 > /dev/null" | shell | trim }}
% soda es shared message -t -v -c lzma > /dev/null
{{ "soda es docs/shared docs/message -t -v -c lzma > /dev/null" | shell | trim }}
% soda es shared message -t -v -c raw > /dev/null
{{ "soda es docs/shared docs/message -t -v -c raw > /dev/null" | shell | trim }}
{% set _ = "rm docs/shared" | shell -%}
```


## Encoding

The rtty-soda supports various encodings:

```
% soda encrypt-public alice bob_pub message --data-encoding base36 --group-len 5 --text
{{ "soda encrypt-public docs/alice docs/bob_pub docs/message --data-encoding base36 --group-len 5 --text" | shell | trim }}
{% set _ = "rm docs/alice docs/alice_pub docs/bob docs/bob_pub" | shell -%}
```


## Environment variables

Common options can be set in the environment variables:

```
% cat ~/.soda/example.env
{{ "cat docs/example.env" | shell | trim }}
```


## Private/secret key passphrase

The key can be protected with an additional passphrase, similar to SSH keys.
When `--key-passphrase <passphrase>` is used, the key is automatically
encrypted or decrypted using the same parameters as the following command:

```
% soda encrypt-password <passphrase> <key> --kdf-profile sensitive --data-encoding binary --compression raw
```


## Alternative usage

- Password source
  ```
  % echo "A line from a book or a poem" | soda kdf - -e base94 -p interactive
  {{ 'echo "A line from a book or a poem" | soda kdf - -e base94 -p interactive' | shell | trim }}
  ```

- WireGuard keyer
  ```
  % echo "A line from a book or a poem" | soda kdf - -p interactive -o privkey
  {% set _ = 'echo "A line from a book or a poem" | soda kdf - -p interactive -o docs/privkey' | shell | trim -%}
  % cat privkey
  {{ "cat docs/privkey" | shell | trim }}
  % soda pubkey privkey
  {{ "soda pubkey docs/privkey" | shell | trim }}
  % cat privkey | wg pubkey
  F2B674kXVcTznnRPWCVasx1miCT+yUtXQ3P5Ecee4zI=
  {% set _ = "rm docs/privkey" | shell -%}
  ```

- Secure storage
  ```
  % echo "A remarkable example of misplaced confidence" > sensitive_data
  {% set _ = 'echo "A remarkable example of misplaced confidence" > docs/sensitive_data' | shell | trim -%}
  % echo "Blessed with opinions, cursed with thought" > data_password
  {% set _ = 'echo "Blessed with opinions, cursed with thought" > docs/data_password' | shell | trim -%}
  % soda ep data_password sensitive_data -e binary -p interactive -o encrypted_data
  {% set _ = 'yes | soda ep docs/data_password docs/sensitive_data -e binary -p interactive -o docs/encrypted_data' | shell | trim -%}
  % echo "Too serious to be wise" > offset_password
  {% set _ = 'echo "Too serious to be wise" > docs/offset_password' | shell | trim -%}
  % soda kdf offset_password -e base10 -p interactive -g 10 | head -1
  {{ "soda kdf docs/offset_password -e base10 -p interactive -g 10 | head -1" | shell | trim }}
  % sudo dd if=./encrypted_data of=/dev/sdb1 bs=1 seek=6174465709
  75+0 records in
  75+0 records out
  75 bytes transferred in 0.000769 secs (97529 bytes/sec)
  {% set _ = "rm docs/sensitive_data docs/data_password docs/offset_password docs/encrypted_data" | shell -%}
  ```

  ![dd diagram](https://github.com/theosaveliev/rtty-soda/raw/main/diagram/dd.png)

- Google Authenticator keyer
  ```
  % soda genkey -e base32 | tee totp_key
  {{ "soda genkey -e base32 | tee docs/totp_key" | shell | trim }}
  % soda google-auth totp_key
  {{ "soda google-auth docs/totp_key" | shell | trim }}
  {% set _ = "rm docs/totp_key" | shell -%}
  ```


## Compatibility

During the initial development (versions prior to 1.0.0),
I can break backwards compatibility.


## Releases

This project follows a rolling release cycle.
Each version bump represents where I completed a full test cycle.
When testing passes successfully, I commit and release - so every release is a verified stable point.